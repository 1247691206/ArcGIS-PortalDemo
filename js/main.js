define(["dojo/_base/declare","dojo/_base/lang","esri/arcgis/utils","dojo/dom","dojo/dom-class","dojo/on","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/dijit/OverviewMap","esri/dijit/Scalebar","component/bar","component/mapinfo","component/query","component/find","component/dataTable","component/buffer","component/heatmap","component/network","component/overlay","dojo/domReady!"],function(t,e,o,i,n,r,s,a,p,c,h,l,u,d,f,g,m,b,y){return t(null,{map:null,config:{},constructor:function(){this.resizeUi(),this.bindDomEvents(),this.bar=new h(this),this.mapinfo=new l(this),this.query=new u(this),this.find=new d(this),this.dataTable=new f(this),this.buffer=new g(this),this.heatmap=new m(this),this.network=new b(this),this.overlay=new y(this)},initComponents:function(){this.bar.startup(),this.mapinfo.startup(),this.query.startup(),this.find.startup(),this.dataTable.startup(),this.buffer.startup(),this.heatmap.startup(),this.network.startup(),this.overlay.startup(),console.log("overlay-startup-end",this.overlay)},startup:function(t){if(esriConfig.defaults.io.proxyUrl="./proxy.jsp",t){this.config=t;var e=this.config.itemInfo||this.config.webmap;this._createWebMap(e)}else{var o=new Error("Main:: Config is not defined");this.reportError(o)}},resizeUi:function(){var t=$("body").height()-$("#mapDiv").position().top;$("#mapDiv, .esricd-panel").height(t);var e=$("body").height()-$(".esricd-panel-tab-content").position().top;$(".esricd-panel-tab-content").height(e)},bindDomEvents:function(){$("body").delegate("[node-type=hidePanel]","click",function(t){var e=$(t.currentTarget).parents(".esricd-panel");e.hasClass("esricd-panel-right")?e.css("right","-300px"):e.css("left","-300px")}),$("body").delegate("[node-type=showPanel]","click",function(t){var e=$(t.currentTarget).attr("data-for"),o=$("#"+e);o.hasClass("esricd-panel-right")?o.css("right","-2px"):o.css("left","-2px")}),$("body").delegate("[node-type=hideBotPanel]","click",function(t){var e=$(t.currentTarget).parents(".esricd-bot-box");e.css("bottom","-200px")})},_helloWorld:function(){console.log("Hello World!"),console.log("My Map:",this.map),console.log("My Config:",this.config)},_createWebMap:function(t){o.createMap(t,"mapDiv",{mapOptions:{},usePopupManager:!0,editable:this.config.editable,bingMapsKey:this.config.bingKey}).then(e.hitch(this,function(t){console.log("_createWebMap-response",t),this.map=t.map,this.addMapControls(),this.initComponents(),console.log("My Map:",this.map),console.log("My Config:",this.config)}),this.reportError)},addMapControls:function(){var t=new s({map:this.map},"HomeButton");t.startup();var e=new p({map:this.map,attachTo:"bottom-right",opacity:.4,visible:!1});e.startup();new c({map:this.map,scalebarUnit:"metric"})},getMapserverUrls:function(){var t=function(t){var e=!1;return"Feature Layer"!=t.resourceInfo.type&&(e=!0),e},e=this.config.itemInfo.itemData.operationalLayers,o=[];return $.each(e,function(e,i){t(i)&&o.push(i.url)}),o},reportError:function(t){console.log("reportError:",t)},test:""})}),Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in e)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[o]:("00"+e[o]).substr((""+e[o]).length)));return t};var esricd_toQueryLayerUrl=function(t){var e="";return e=/\/\d+$/.test(t)?t:t+"/0"},esricd_isReorderableLayer=function(t){var e=!1;return e="Feature Layer"==t.resourceInfo.type?!1:!0};!function(){var t=!1;t&&alert("系统不支持ie8及以下版本浏览器访问！\n 请使用ie9+或chrome、safari等浏览器。")}();